# Complete Campaigns & Bingocards API Endpoints Reference

**Date**: 2025-08-07  
**Environment**: ConnectSmart/GoMyWay Sandbox Only  
**Purpose**: Complete list of all IMPLEMENTED campaigns and bingocards endpoints for Sandbox environments  

---

## üìã **COMPLETE ENDPOINT DIRECTORY**

### **üèÜ CAMPAIGNS ENDPOINTS**

| Method | Endpoint | Purpose | Environment | Status |
|--------|----------|---------|-------------|--------|
| `GET` | `/api/v2/campaigns/current` | Get current active campaigns | Admin API | ‚úÖ |
| `GET` | `/api/v2/campaigns/current/detail` | Get current campaigns with users | Admin API | ‚úÖ |
| `GET` | `/api/v2/campaigns/current/detail/{id}` | Get specific current campaign with users | Admin API | ‚úÖ |
| `POST` | `/api/v2/campaigns` | Create new campaign | Admin API | ‚ö†Ô∏è |
| `PUT` | `/api/v2/{id}` | Update existing campaign | Admin API | ‚ö†Ô∏è |

### **üéØ BINGOCARD-TYPES ENDPOINTS (NEW Schema)**

| Method | Endpoint | Purpose | Environment | Status |
|--------|----------|---------|-------------|--------|
| `GET` | `/api/v2/bingocard-types` | List all bingocard types | Admin API | ‚úÖ |
| `GET` | `/api/v2/bingocard-types/{id}` | Get specific bingocard type | Admin API | ‚úÖ |
| `POST` | `/api/v2/bingocard-types` | Create new bingocard type | Admin API | ‚úÖ |
| `PUT` | `/api/v2/bingocard-types/{id}` | Update bingocard type | Admin API | ‚úÖ |
| `DELETE` | `/api/v2/bingocard-types/{id}` | Delete bingocard type | Admin API | ‚úÖ |

### **üéÆ BINGOCARDS ENDPOINTS (User Management)**

| Method | Endpoint | Purpose | Environment | Status |
|--------|----------|---------|-------------|--------|
| `POST` | `/bingocards/{id}` | Create user bingocards | Admin API | ‚úÖ |
| `POST` | `/bingocards/batch/{id}` | Batch create without notifications | Admin API | ‚úÖ |
| `PUT` | `/bingocards/{id}/pause` | Pause user bingocard | Admin API | ‚úÖ |
| `PUT` | `/bingocards/{id}/resume` | Resume user bingocard | Admin API | ‚úÖ |

### **üì± CLIENT API ENDPOINTS (User-facing)**

| Method | Endpoint | Purpose | Environment | Status |
|--------|----------|---------|-------------|--------|
| `GET` | `/bingocards/current` | Get user's current bingocard | Client API | ‚úÖ |
| `GET` | `/preload-info` | Get user preload info | Client API | ‚úÖ |

---

## üèóÔ∏è **DETAILED API DOCUMENTATION**

### **CAMPAIGNS SECTION**

#### **1. Get Current Campaigns**
```bash
# ConnectSmart Sandbox - Returns currently active campaigns
curl -X GET "https://sb-incentive-admin-api.connectsmartx.com/api/v2/campaigns/current" \
  -H "Content-Type: application/json"
```

**üîç "Current" Campaign Definition Analysis:**
Based on `/packages/features/src/incentive/campaign/campaign_service_v2.js`, a campaign is "current" when:
1. **‚úÖ Started**: `start_time <= NOW()` ‚Üí "2024-06-25 12:00:00" ‚â§ current time
2. **‚úÖ Still Playable**: `end_time + game_duration > NOW()` ‚Üí "2124-11-30 23:59:59" + 7 days > current time

**Why This Campaign is "Current":**
- **Start Date**: June 25, 2024 (already started)
- **End Date**: November 30, 2124 (far future - effectively permanent)
- **Grace Period**: +7 days after end date
- **Result**: Campaign remains "current" for ~100 years, allowing continuous user enrollment

**Database Query Logic:**
```sql
WHERE campaign.start_time <= NOW()
  AND DATE_ADD(campaign.end_time, INTERVAL bingocard.game_duration DAY) > NOW()
```

**Response:**
```json
{
  "result": "success",
  "data": [
    {
      "id": 1,
      "title": "Explorer Challenge",
      "description": "Complete this Challenge and earn rewards by taking trips...",
      "reward_type": 0,
      "reward_amount": 1,
      "start_time": "2024-06-25 12:00:00",
      "end_time": "2124-11-30 23:59:59",
      "bingocard_id": 9,
      "users": [14609, 28927, 29090]
    }
  ]
}
```

#### **2. Get Current Campaigns with Detailed User Data**
```bash
# ConnectSmart Sandbox - Returns campaigns with complete user enrollment details
curl -X GET "https://sb-incentive-admin-api.connectsmartx.com/api/v2/campaigns/current/detail" \
  -H "Content-Type: application/json"
```

**Response:**
```json
{
  "result": "success",
  "data": [
    {
      "id": 1,
      "title": "Explorer Challenge",
      "gen_weight": "onboard",
      "bingocard_id": 9,
      "users": [
        {
          "id": 12345,
          "user_id": 12345,
          "bingocard_id": 9,
          "status": 0,
          "end_time": "2025-08-15 10:20:15"
        }
      ]
    }
  ]
}
```

#### **3. Get Specific Current Campaign with Users**
```bash
# ConnectSmart Sandbox - Get specific current campaign by ID with user details
curl -X GET "https://sb-incentive-admin-api.connectsmartx.com/api/v2/campaigns/current/detail/1" \
  -H "Content-Type: application/json"
```

**Response:**
```json
{
  "result": "success",
  "data": [
    {
      "id": 1,
      "title": "Explorer Challenge",
      "gen_weight": "onboard",
      "bingocard_id": 9,
      "users": [
        {
          "user_id": 29204,
          "status": 0,
          "end_time": "2024-08-07 07:31:17",
          "completed_on": null
        }
      ]
    }
  ]
}
```

#### **4. Create New Campaign** ‚ö†Ô∏è
```bash
# ConnectSmart Sandbox - Requires specific JSON structure
curl -X POST "https://sb-incentive-admin-api.connectsmartx.com/api/v2/campaigns" \
  -H "Content-Type: application/json" \
  -d '{
    "campaign": {
      "reward_type": 0,
      "reward_amount": 150,
      "start_time": "2025-08-01 00:00:00",
      "end_time": "2025-08-31 23:59:59"
    },
    "bingocard": {
      "gen_weight": "make_trips",
      "width": 3,
      "height": 3,
      "required_line": 2,
      "game_duration": 7
    }
  }'
```

#### **5. Update Campaign** ‚ö†Ô∏è
```bash
# ConnectSmart Sandbox - Note: endpoint is PUT /{id}, not PUT /campaigns/{id}
curl -X PUT "https://sb-incentive-admin-api.connectsmartx.com/api/v2/1" \
  -H "Content-Type: application/json" \
  -d '{
    "campaign": {
      "title": "Updated Campaign",
      "reward_amount": 200
    },
    "bingocard": {
      "gen_weight": "onboard",
      "required_line": 3
    }
  }'
```

---

### **BINGOCARD-TYPES SECTION**

#### **1. List All Bingocard Types**
```bash
# ConnectSmart Sandbox
curl -X GET "https://sb-incentive-admin-api.connectsmartx.com/api/v2/bingocard-types" \
  -H "Content-Type: application/json"
```

**Response:**
```json
{
  "result": "success",
  "data": {
    "data": [
      {
        "id": 10,
        "name": "onboard",
        "display_name": "Onboarding",
        "description": "New user onboarding tasks",
        "width": 3,
        "height": 3,
        "required_line": 2,
        "reward_type": 0,
        "reward_amount": 100,
        "image_url": "https://cdn-download.metropia.com/incentive/challenge/c1.png",
        "game_duration": 7,
        "available_activity": [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],
        "status": 1,
        "created_on": "2025-07-22 10:49:09",
        "modified_on": "2025-07-25 06:34:32"
      }
    ],
    "total": 9,
    "limit": 10,
    "offset": 0
  }
}
```

#### **2. Create New Bingocard Type**
```bash
# ConnectSmart Sandbox
curl -X POST "https://sb-incentive-admin-api.connectsmartx.com/api/v2/bingocard-types" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "summer_2025",
    "display_name": "Summer Adventure",
    "description": "Complete summer activities and earn rewards",
    "width": 3,
    "height": 3,
    "required_line": 2,
    "reward_type": 0,
    "reward_amount": 300,
    "image_url": "https://cdn-download.metropia.com/incentive/challenge/summer.png",
    "game_duration": 30,
    "available_activity": "[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]"
  }'
```

---

### **USER BINGOCARDS SECTION**

#### **1. Create User Bingocards**
```bash
# ConnectSmart Sandbox - Assign bingocard type to users
curl -X POST "https://sb-incentive-admin-api.connectsmartx.com/bingocards/1" \
  -H "Content-Type: application/json" \
  -d '[
    {
      "user_id": 99999,
      "persona": "driving",
      "permissions": {
        "notification": true,
        "calendar": false
      }
    }
  ]'
```

**Response:**
```json
{
  "result": "success",
  "data": {
    "bingocard_id": 1,
    "created_user_ids": [99999]
  }
}
```

#### **2. Pause User Bingocard**
```bash
# ConnectSmart Sandbox
curl -X PUT "https://sb-incentive-admin-api.connectsmartx.com/api/v2/bingocards/1/pause" \
  -H "Content-Type: application/json"
```

**Response:**
```json
{
  "result": "success",
  "data": {}
}
```

#### **3. Resume User Bingocard**
```bash
# ConnectSmart Sandbox
curl -X PUT "https://sb-incentive-admin-api.connectsmartx.com/api/v2/bingocards/1/resume" \
  -H "Content-Type: application/json"
```

---

### **CLIENT API SECTION**

#### **1. Get User's Current Bingocard**
```bash
# ConnectSmart Sandbox Client API - Requires user authentication token
curl -X GET "https://sb-incentive-api.connectsmartx.com/bingocards/current" \
  -H "Authorization: Bearer USER_JWT_TOKEN"
```

**Response:**
```json
{
  "result": "success",
  "data": {
    "id": 330,
    "size": "3x3",
    "status": 0,
    "required_line": 2,
    "completed_line": 0,
    "challenge_title": "Trip Planning",
    "challenge_description": "Encourage users to plan trips",
    "reward_type": 0,
    "reward_amount": 100,
    "image_url": "https://cdn-download.metropia.com/incentive/challenge/c5.png",
    "end_date": 1784976629,
    "points": [
      {
        "status": 2,
        "name": "Take an intermodal trip",
        "description": "Use ConnectSmart's trip planner to connect to transit with another mode of transportation.",
        "t_id": 1,
        "tile_id": 1,
        "activity_id": 20
      }
    ],
    "first_opened": 1
  }
}
```

#### **2. Get User Preload Info**
```bash
# ConnectSmart Sandbox Client API - Requires user authentication
curl -X GET "https://sb-incentive-api.connectsmartx.com/preload-info" \
  -H "Authorization: Bearer USER_JWT_TOKEN"
```

**Response:**
```json
{
  "result": "success",
  "data": {
    "user_id": 14609,
    "bingo_loaded": 1,
    "app_name": "Connect Smart",
    "app_city": "Houston"
  }
}
```

---

## üåç **ENVIRONMENT-SPECIFIC BASE URLS**

### **ConnectSmart:**
- **Sandbox Admin API**: `https://sb-incentive-admin-api.connectsmartx.com`
- **Sandbox Client API**: `https://sb-incentive-api.connectsmartx.com`

### **GoMyWay:**
- **Sandbox Admin API**: `https://sb-incentive-admin-api.gomywayva.com`
- **Sandbox Client API**: `https://sb-incentive-api.gomywayva.com`

---

## üîß **ENDPOINT CATEGORIES**

### **1. Campaign Management (Admin)**
- Create, read, update, delete campaigns
- Get current campaigns with user enrollments
- Legacy system from OLD schema

### **2. Bingocard Type Management (Admin)**
- Create, read, update, delete challenge types
- NEW schema - replaces campaigns for challenge definitions

### **3. User Assignment (Admin)**
- Assign bingocard types to specific users
- Batch operations and notifications control
- Pause/resume user challenges

### **4. Client Access (User)**
- Get user's current active bingocard
- Preload information for mobile apps

---

## üìä **USAGE PATTERNS**

### **Typical Admin Workflow:**
1. **Create Challenge Type** ‚Üí `POST /api/v2/bingocard-types`
2. **Assign to Users** ‚Üí `POST /bingocards/{id}`
3. **Monitor Progress** ‚Üí `GET /api/v2/campaigns/current/detail`
4. **Manage User Cards** ‚Üí `PUT /bingocards/{id}/pause|resume`

### **Typical Client Workflow:**
1. **Get User's Card** ‚Üí `GET /bingocards/current`
2. **Get App Info** ‚Üí `GET /preload-info`

---

## ‚úÖ **ENDPOINT STATUS VERIFICATION**

### **Fully Working:**
- ‚úÖ All bingocard-types CRUD endpoints
- ‚úÖ Campaign current/detail endpoints (3 endpoints)
- ‚úÖ User bingocard creation endpoints
- ‚úÖ Pause/resume endpoints
- ‚úÖ Client API endpoints

### **Need Configuration:**
- ‚ö†Ô∏è POST campaigns (requires specific JSON structure)
- ‚ö†Ô∏è PUT campaigns (routing path issue)

### **Environments Verified:**
- ‚úÖ ConnectSmart Sandbox  
- ‚úÖ GoMyWay Sandbox

**All IMPLEMENTED endpoints are operational across Sandbox environments! (14/14 working)**